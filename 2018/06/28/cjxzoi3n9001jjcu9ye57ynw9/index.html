<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>gitlabå®‰è£…æ•™ç¨‹ | kirnoã®Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="è¿™æ˜¯ä¸€ç‰‡å…³äºGitLabçš„å®‰è£…æ•™ç¨‹ä»¥åŠè¸©è¿‡çš„å‘  æµªè´¹äº†ä¸€ä¸ªä¸‹åˆçš„æ—¶é—´ï¼Œç»ˆäºæŠŠGitlabæ­å»ºå®Œæˆï¼Œæ­å»ºç¯å¢ƒå¦‚ä¸‹ï¼š  ç³»ç»Ÿï¼ˆè™šæ‹Ÿæœºï¼‰   Distributor ID:    Ubuntu   Description:    Ubuntu 18.04 LTS   Release:    18.04   Codename:    bionic  gitlab V11.0.1">
<meta name="keywords" content="gitlab,git">
<meta property="og:type" content="article">
<meta property="og:title" content="gitlabå®‰è£…æ•™ç¨‹">
<meta property="og:url" content="https://kirning.github.io/2018/06/28/cjxzoi3n9001jjcu9ye57ynw9/index.html">
<meta property="og:site_name" content="kirnoã®Blog">
<meta property="og:description" content="è¿™æ˜¯ä¸€ç‰‡å…³äºGitLabçš„å®‰è£…æ•™ç¨‹ä»¥åŠè¸©è¿‡çš„å‘  æµªè´¹äº†ä¸€ä¸ªä¸‹åˆçš„æ—¶é—´ï¼Œç»ˆäºæŠŠGitlabæ­å»ºå®Œæˆï¼Œæ­å»ºç¯å¢ƒå¦‚ä¸‹ï¼š  ç³»ç»Ÿï¼ˆè™šæ‹Ÿæœºï¼‰   Distributor ID:    Ubuntu   Description:    Ubuntu 18.04 LTS   Release:    18.04   Codename:    bionic  gitlab V11.0.1">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://oepv0v7je.bkt.clouddn.com/18-7-10/20173328.jpg">
<meta property="og:updated_time" content="2019-01-27T10:37:54.352Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="gitlabå®‰è£…æ•™ç¨‹">
<meta name="twitter:description" content="è¿™æ˜¯ä¸€ç‰‡å…³äºGitLabçš„å®‰è£…æ•™ç¨‹ä»¥åŠè¸©è¿‡çš„å‘  æµªè´¹äº†ä¸€ä¸ªä¸‹åˆçš„æ—¶é—´ï¼Œç»ˆäºæŠŠGitlabæ­å»ºå®Œæˆï¼Œæ­å»ºç¯å¢ƒå¦‚ä¸‹ï¼š  ç³»ç»Ÿï¼ˆè™šæ‹Ÿæœºï¼‰   Distributor ID:    Ubuntu   Description:    Ubuntu 18.04 LTS   Release:    18.04   Codename:    bionic  gitlab V11.0.1">
<meta name="twitter:image" content="http://oepv0v7je.bkt.clouddn.com/18-7-10/20173328.jpg">
  
    <link rel="alternate" href="/atom.xml" title="kirnoã®Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">kirnoã®Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://kirning.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-gitlabInstall" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/06/28/cjxzoi3n9001jjcu9ye57ynw9/" class="article-date">
  <time datetime="2018-06-28T09:37:12.000Z" itemprop="datePublished">2018-06-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      gitlabå®‰è£…æ•™ç¨‹
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>è¿™æ˜¯ä¸€ç‰‡å…³äºGitLabçš„å®‰è£…æ•™ç¨‹ä»¥åŠè¸©è¿‡çš„å‘</p>
</blockquote>
<p>æµªè´¹äº†ä¸€ä¸ªä¸‹åˆçš„æ—¶é—´ï¼Œç»ˆäºæŠŠGitlabæ­å»ºå®Œæˆï¼Œæ­å»ºç¯å¢ƒå¦‚ä¸‹ï¼š</p>
<ul>
<li><p>ç³»ç»Ÿï¼ˆè™šæ‹Ÿæœºï¼‰</p>
<p>  Distributor ID:    Ubuntu</p>
<p>  Description:    Ubuntu 18.04 LTS</p>
<p>  Release:    18.04</p>
<p>  Codename:    bionic</p>
</li>
<li><p>gitlab V11.0.1</p>
</li>
</ul>
<a id="more"></a>
<h2 id="å®‰è£…Gitlab"><a href="#å®‰è£…Gitlab" class="headerlink" title="å®‰è£…Gitlab"></a>å®‰è£…Gitlab</h2><p>è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œgitlabå®˜æ–¹æºå¤ªæ…¢äº†ï¼Œä¸€ä¸ªgitlabå®‰è£…åŒ…è¦<code>500M+</code>å¦‚æœç›´æ¥ä¸‹è½½ï¼Œå¾ˆå®¹æ˜“æŒ‚æ‰ï¼Œæˆ–è€…ç­‰å¾ˆä¹…ï¼Œæ‰€ä»¥è¿™é‡Œè¦æ›¿æ¢æºã€‚ä¸è¿‡ä¼¼ä¹åœ¨é˜¿é‡Œäº‘ä¸Šæ­è½½çš„è¯ï¼Œä¼šå¾ˆå¿«ï¼Œä¸ç”¨æ›´æ¢ã€‚</p>
<p>è¿™é‡Œæ¨è <a href="https://mirrors.tuna.tsinghua.edu.cn/" target="_blank" rel="noopener">æ¸…åå¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™</a> é‡Œé¢æœ‰ä¸å°‘çš„é•œåƒæºï¼Œå…¶ä¸­å°±åŒ…æ‹¬äº†gitlabçš„ã€‚</p>
<p>å…·ä½“åœ°å€æ˜¯</p>
<pre><code>deb http://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/ubuntu bionic main
</code></pre><blockquote>
<p>æ³¨æ„å…¶ä¸­ <code>bionic</code> æ˜¯ç³»ç»Ÿä»£å·ï¼Œæ¯”å¦‚æˆ‘çš„ubuntu 18 ä»£å·å°±æ˜¯ <code>bionic</code> å…¶ä»–çš„ç³»ç»Ÿå¯ä»¥ä½¿ç”¨ <code>lsb_relase</code> å‘½ä»¤è‡ªè¡ŒæŸ¥è¯¢ã€‚</p>
</blockquote>
<p><strong>ä½¿ç”¨æ–¹æ³•</strong> <a href="https://mirrors.tuna.tsinghua.edu.cn/help/gitlab-ce/" target="_blank" rel="noopener">å‚è€ƒ</a></p>
<ol>
<li><p>ä¿¡ä»» GitLab çš„ GPG å…¬é’¥:</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl https://packages.gitlab.com/gpg.key 2&gt; /dev/null | sudo apt-key add - &amp;&gt;/dev/null<br></code></pre></td></tr></table></figure>
</li>
<li><p>è®¾ç½®æº</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd /etc/apt/sources.list.d<br>vim gitlab-ce.list<br></code></pre></td></tr></table></figure>
</li>
<li><p>ç¼–è¾‘gitlab-ce.list è¾“å…¥ä»¥ä¸‹å†…å®¹</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">deb https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/ubuntu/ bionic main<br></code></pre></td></tr></table></figure>
</li>
<li><p>æ›´æ–°å¹¶å®‰è£…</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get update<br>sudo apt-get install gitlab-ce<br></code></pre></td></tr></table></figure>
</li>
<li><p>é…ç½®gitlab</p>
<p> ç”±äºgitlabè¦ç”¨åˆ°åŸŸåï¼Œæ‰€ä»¥éœ€è¦å‡†å¤‡å¥½åŸŸåã€‚ç”±äºæˆ‘æ˜¯ç”¨è™šæ‹Ÿæœºæ­å»ºï¼Œæ‰€ä»¥å…¬å…±åŸŸåç”¨ä¸äº†ï¼Œæ‰€ä»¥æˆ‘å°±è‡ªå·±æ­å»ºäº†ä¸€ä¸ªåŸŸåæœåŠ¡ã€‚å¯ä»¥å‚è€ƒå¯é€‰æ­¥éª¤ï¼Œæ­å»ºç§æœ‰DNSæœåŠ¡å™¨ã€‚</p>
<p> é…ç½®æ–‡ä»¶æ˜¯ <code>/etc/gitlab/gitlab.rb</code> æ–‡ä»¶ï¼Œå› ä¸ºæ–‡ä»¶å†…å®¹è¿‡å¤šï¼Œå°±ç®€å•çš„æŠŠä¼šç”¨åˆ°çš„é…ç½®åˆ—å‡ºæ¥</p>
<ol>
<li><p>åŸŸåï¼Œè¿™ä¸ªè®¾è®¡åˆ°äº†gitlabç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆçš„é“¾æ¥ï¼Œæ‰€ä»¥å¿…é¡»ä¿®æ”¹ä¸º<strong>è‡ªå·±çš„åŸŸå</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs undefined"># external_url &apos;http://gitlab.explme.com&apos;<br>external_url &apos;http://kirno.com&apos;<br></code></pre></td></tr></table></figure>
</li>
<li><p>é…ç½®æ—¶åŒºï¼Œç”±äºé»˜è®¤æ˜¯UTCï¼Œå¯¼è‡´ä½¿ç”¨çš„æ—¶å€™æ—¶é—´ä¸æ­£ç¡®ï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹ä¸ºæœ¬åœ°çš„æ—¶åŒº</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs undefined"># gitlab_rails[&apos;time_zone&apos;] = &apos;UTC&apos;<br>gitlab_rails[&apos;time_zone&apos;] = &apos;Asia/Shanghai&apos;<br></code></pre></td></tr></table></figure>
</li>
<li><p>é‚®ä»¶ï¼Œç”±äºgitlabä¼šé€šè¿‡é‚®ç®±æ‰¾å›å¯†ç æˆ–è€…è®¤è¯ï¼Œæ‰€ä»¥éœ€è¦é…ç½®ã€‚åŸæœ¬æ˜¯ä½¿ç”¨ç³»ç»Ÿè‡ªå·±çš„é‚®ä»¶ç³»ç»Ÿï¼Œä½†æ˜¯æˆ‘ä¸ä¼šé…ç½®ï¼Œæ‰€ä»¥å°±æ˜¯ç”¨äº†QQé‚®ç®±ä½œä¸ºå‘é€æ–¹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs undefined">gitlab_rails[&apos;smtp_enable&apos;] = true<br>gitlab_rails[&apos;smtp_address&apos;] = &quot;smtp.qq.com&quot;<br>gitlab_rails[&apos;smtp_port&apos;] = 465<br># å‘é€æ–¹çš„é‚®ç®±å®Œæ•´åœ°å€ xx@qq.com<br>gitlab_rails[&apos;smtp_user_name&apos;] = &quot;XXX&quot;<br># è¿™é‡Œæ˜¯å‘é€æ–¹çš„QQé‚®ç®±åœ°å€ï¼Œä¹Ÿå°±æ˜¯å’Œä¸Šé¢çš„ä¸€æ ·<br>gitlab_rails[&apos;gitlab_email_from&apos;] = &apos;XXX&apos;<br># å¯†ç ï¼Œæ³¨æ„è¿™é‡Œè¦ä½¿ç”¨QQé‚®ç®±çš„ æˆæƒç  ä¸æ˜¯å¯†ç ï¼Œå¯ä»¥åœ¨è®¾ç½®ï¼Œè´¦æˆ·å¤„æ‰¾åˆ°<br>gitlab_rails[&apos;smtp_password&apos;] = &quot;xxx&quot;    <br>gitlab_rails[&apos;smtp_domain&apos;] = &quot;smtp.qq.com&quot;<br>gitlab_rails[&apos;smtp_authentication&apos;] = &quot;login&quot;<br>gitlab_rails[&apos;smtp_enable_starttls_auto&apos;] = true<br>gitlab_rails[&apos;smtp_tls&apos;] = true<br></code></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ol>
<p>é…ç½®å®Œæˆååˆå§‹åŒ– gitlab æ—¶é—´æ¯”è¾ƒä¹…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gitlab-ctl reconfigure<br></code></pre></td></tr></table></figure>
<p>å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æµ‹è¯•é‚®ä»¶</p>
<pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è¿›å…¥æ§åˆ¶å°</span><br>gitlab-rails console<br><span class="hljs-comment"># å‘é€é‚®ä»¶</span><br>Notify.test_email(<span class="hljs-string">"æ”¶ä»¶äººé‚®ç®±"</span>, <span class="hljs-string">"æ ‡é¢˜"</span>, <span class="hljs-string">"å†…å®¹"</span>).deliver_now<br></code></pre></td></tr></table></figure>
</code></pre><p>ç„¶åå°±å¯ä»¥åœ¨æµè§ˆå™¨é€šè¿‡åŸŸåè®¿é—®äº†</p>
<h2 id="æ±‰åŒ–æ•™ç¨‹"><a href="#æ±‰åŒ–æ•™ç¨‹" class="headerlink" title="æ±‰åŒ–æ•™ç¨‹"></a>æ±‰åŒ–æ•™ç¨‹</h2><p>é»˜è®¤çš„gitlabæ˜¯è‹±æ–‡ï¼Œå¯ä»¥é€‰æ‹©è¿›è¡Œæ±‰åŒ–ï¼Œä¸è¿‡å…¶å®æ±‰åŒ–å¹¶ä¸å®Œæ•´ã€‚</p>
<ol>
<li><p><a href="https://gitlab.com/xhang/gitlab/tags" target="_blank" rel="noopener">ä¸‹è½½æ±‰åŒ–æ–‡ä»¶</a> æ–‡ä»¶æ¯”è¾ƒå¤§åœ¨ 48m+ å·¦å³ï¼Œè€Œä¸”ä¸‹è½½æ¯”è¾ƒæ…¢ï¼Œæ‰€ä»¥å»ºè®®ä¸‹è½½å®Œæ‹‰ä¸ŠæœåŠ¡å™¨ã€‚</p>
<blockquote>
<p>ä¸€å®šè¦æ³¨æ„ç‰ˆæœ¬ï¼Œå·²å®‰è£…çš„gitlabç‰ˆæœ¬å¯ä»¥é€šè¿‡ <code>cat /opt/gitlab/embedded/service/gitlab-rails/VERSION</code> å‘½ä»¤æŸ¥çœ‹</p>
</blockquote>
</li>
<li><p>ä¸‹è½½å®Œä¹‹åè§£å‹ï¼Œé€šè¿‡ <code>cat gitlab/VERSION</code> æŸ¥çœ‹æ˜¯ç‰ˆæœ¬æ˜¯å¦åŒ¹é…ï¼Œå¦‚æœç‰ˆæœ¬ä¸åŒ¹é…å¯èƒ½ä¼šå¯¼è‡´gitlabå´©æºƒï¼Œæ‰€ä»¥å°å¿ƒ</p>
</li>
<li><p>åœæ­¢gitlab</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs undefined">gitlab-ctl stop<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>è¦†ç›– </li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">cp -rf gitlab/* /opt/gitlab/embedded/service/gitlab-rails/<br></code></pre></td></tr></table></figure>
<ol start="4">
<li>é‡æ–°é…ç½®gitlabå¹¶å¯åŠ¨å®ƒ</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">gitlab-ctl reconfigure<br>gitlab-ctl restart<br></code></pre></td></tr></table></figure>
<h2 id="ä½¿ç”¨ç°æœ‰çš„Nginxä½œä¸ºæœåŠ¡å™¨"><a href="#ä½¿ç”¨ç°æœ‰çš„Nginxä½œä¸ºæœåŠ¡å™¨" class="headerlink" title="ä½¿ç”¨ç°æœ‰çš„Nginxä½œä¸ºæœåŠ¡å™¨"></a>ä½¿ç”¨ç°æœ‰çš„Nginxä½œä¸ºæœåŠ¡å™¨</h2><p>è¿™ä¸ªåœ°æ–¹å·¨å‘ï¼ŒçœŸçš„æ˜¯å·¨å‘ï¼Œè¢«å¡åœ¨è¿™é‡Œå¤ªä¹…äº†ğŸ˜­ã€‚<br>é¦–å…ˆé€šè¿‡apt-getæˆ–è€…ä»å®˜ç½‘ä¸‹è½½çš„nginxï¼Œå¦‚æœæ²¡æœ‰æ³¨æ„çš„è¯éƒ½ä¸è¡Œï¼Œå› ä¸ºä»–ä»¬é»˜è®¤éƒ½ä¸æ”¯æŒ <code>Passenger</code> è¿™æ˜¯ä¸ªå·¨å‘å•Šï¼Œå¤šå°‘æ¬¡å› ä¸ºè¿™ä¸ªæ‘”é¼ æ ‡äº†ğŸ–±ï¸ã€‚è™½ç„¶ç½‘ä¸Šæœ‰æ•™ç¨‹é€šè¿‡ passenger-install-nginx-modules çš„æ–¹å¼æ¥é‡æ–°å®‰è£…nginxï¼Œä½†æ˜¯è¿™ä¸ªçš„ç¼–è¯‘è¿‡ç¨‹è´¼æ…¢ï¼Œæˆ‘çš„åŒæ ¸4gäº‘æœåŠ¡å™¨å®Œå…¨å¡æ­»åœ¨è¿™äº†ï¼Œæ‰€ä»¥ä¸æ¨èã€‚è¿˜æœ‰çš„åŠæ³•å°±æ˜¯é€šè¿‡åˆ©ç”¨ <code>nginx 1.9</code> ä»¥ä¸Šçš„ç‰ˆæœ¬çš„åŠ¨æ€æ¨¡å—åŠ è½½åŠŸèƒ½æ¥å®ç°ã€‚</p>
<ol>
<li>å®‰è£… <code>ruby</code> æ²¡åŠæ³•ï¼Œpassengerä¾èµ– <code>ruby</code></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt install ruby<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>å®‰è£… <code>passenger</code> å®‰è£…è¿™ä¸ªä¸œè¥¿æœ€å¥½æ¢æºï¼Œå¦åˆ™å·¨æ…¢</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">æ¢æº</span><br>gem sources --add https://gems.ruby-china.com/ --remove https://rubygems.org/<br><span class="hljs-meta">$</span><span class="bash"> gem sources -l</span><br>https://gems.ruby-china.com<br><span class="hljs-meta">#</span><span class="bash"> ç¡®ä¿åªæœ‰ gems.ruby-china.com</span><br><span class="hljs-meta"><br>#</span><span class="bash">å®‰è£…</span><br>gem install passenger<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>ä¸‹è½½nginxæºç ï¼Œç¼–è¯‘æ¨¡å—ï¼Œ<a href="https://www.phusionpassenger.com/library/install/nginx/install_as_nginx_module.html" target="_blank" rel="noopener">å‚è€ƒ</a></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd /path-to-nginx-source-dir<br>./configure --prefix=/opt/nginx \<br>  --add-dynamic-module=$(passenger-config --nginx-addon-dir) \<br>  --add-module=/path-to-some-other-nginx-module<br>make<br>sudo make install<br></code></pre></td></tr></table></figure>
<ol start="4">
<li>é…ç½®ç°æœ‰çš„nginxçš„é…ç½®æ–‡ä»¶ <code>nginx.conf</code>, æ·»åŠ </li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs nginx">#user  nobody;<br>worker_processes  1;<br><br>#============é‡ç‚¹================================<br>load_module modules/ngx_http_passenger_module.so;<br>#===============================================<br><br>events &#123;<br>    worker_connections  1024;<br>&#125;<br><br><br>http &#123;<br>    include       mime.types;<br>    default_type  application/octet-stream;<br><br>    #============é‡ç‚¹===å¦‚æœå¿˜è®°passengerçš„ç›®å½•äº†ï¼Œå¯ä»¥é€šè¿‡ passenger-config --root æŒ‡ä»¤æ¥è·å–=============================<br>    passenger_root /var/lib/gems/2.3.0/gems/passenger-5.3.3;<br>    #===============================================<br><br>    sendfile        on;<br><br>    keepalive_timeout  65;<br>    ...<br></code></pre></td></tr></table></figure>
<ol start="5">
<li>é‡ä¸­ä¹‹é‡ï¼Œè¿™é‡Œæœ€å‘ï¼Œé…ç½®äº†å¥½äº†<code>nginx</code>ä¹‹åæŠ¥äº†ä¸€ä¸ªå¥‡è‘©ğŸ¤®çš„é”™è¯¯</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs undefined">2018/07/10 10:44:19 [crit] 28138#0: *3739 connect() to unix:/tmp/passenger.uPSo3Mj/agents.s/core failed (2: No such file or directory) while connecting to upstream, client: 119.127.17.115, server: xxx, request: &quot;GET / HTTP/1.1&quot;, upstream: &quot;passenger:unix:/tmp/passenger.uPSo3Mj/agents.s/core:&quot;, host: &quot;xxx&quot;<br></code></pre></td></tr></table></figure>
<p>è¿™ä¸ªåœ°æ–¹æµªè´¹äº†æˆ‘ä¸€ä¸ªä¸‹åˆåŠ åŠä¸ªæ—©ä¸ŠğŸŒï¼Œå¤šæ¬¡æƒ³æ”¾å¼ƒï¼Œç½‘ä¸Šè¿˜æ‰¾ä¸åˆ°èµ„æ–™ã€‚å…¶å®è§£å†³ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯é‡å¯nginxï¼Œä¸èƒ½ç®€å•çš„<code>nginx -s reload</code> æˆ–è€… <code>nginx -s reopen</code> çš„é‡å¯ï¼Œæ²¡æœ‰æ•ˆæœçš„ï¼Œå¿…é¡»è¦å…ˆ <code>kill</code> äº†nginxçš„è¿›ç¨‹ç„¶åå†é‡æ–°è¿è¡Œ <code>nginx</code> æ‰è¡ŒğŸ˜­ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘é‡è£…äº†gitlabï¼Œå„ç§ç™¾åº¦ï¼Œè°·æ­Œï¼Œå·®ç‚¹å°±å»çœ‹gitlabæºç äº†ğŸ˜­ã€‚æ‰‹æŠ–é‡å¯ngxinåæˆåŠŸçœ‹åˆ°<code>/tmp</code>ä¸‹åˆ›å»º<code>passenger.xxx</code>æ–‡ä»¶ï¼Œå¤ªå¼€å¿ƒäº†ã€‚ç„¶ååˆ·æ–°é¡µé¢æœç„¶æˆåŠŸ</p>
<ol start="6">
<li>ä¸€å®šè¦è®°ä½é…ç½® <code>passenger_root /var/lib/gems/2.3.0/gems/passenger-5.3.3;</code> å¦åˆ™ä¹Ÿä¼šå‡ºç°403é”™è¯¯</li>
</ol>
<p><img src="http://oepv0v7je.bkt.clouddn.com/18-7-10/20173328.jpg" alt="æˆåŠŸå›¾"></p>
<h2 id="å¯é€‰-æ­å»ºç§æœ‰DNSæœåŠ¡å™¨"><a href="#å¯é€‰-æ­å»ºç§æœ‰DNSæœåŠ¡å™¨" class="headerlink" title="(å¯é€‰)æ­å»ºç§æœ‰DNSæœåŠ¡å™¨"></a>(å¯é€‰)æ­å»ºç§æœ‰DNSæœåŠ¡å™¨</h2><p>ç½‘ä¸ŠåŸºæœ¬éƒ½æ˜¯ <code>bind9</code> çš„æ•™ç¨‹ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿå°±ä½¿ç”¨å®ƒæ¥æ­å»ºã€‚</p>
<p>é¦–å…ˆå®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get install bind9<br></code></pre></td></tr></table></figure>
<p>å®‰è£…äº†ä¹‹åï¼Œæœ‰å‡ ä¸ªè·¯å¾„éœ€è¦äº†è§£</p>
<ul>
<li>/etc/bind ç”¨äºå­˜æ”¾ä¸»è¦çš„é…ç½®æ–‡ä»¶</li>
<li>/var/cache/bind ç”¨äºå­˜æ”¾åŸŸåç›¸å…³çš„é…ç½®æ–‡ä»¶</li>
</ul>
<p>æ¯”å¦‚æˆ‘è¦åˆ›å»ºä¸€ä¸ª <code>kirno.com</code> çš„åŸŸå</p>
<p>é¦–å…ˆç¼–è¾‘ <code>/etc/bind/named.conf.local</code> æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs undefined">// è¿™é‡Œçš„ kirno.com å°±æ˜¯æƒ³è¦åˆ›å»ºçš„åŸŸå<br>zone &quot;kirno.com&quot; &#123;    <br>    type master;<br><br>    // è¿™ä¸ªå¯¹åº”ç€ /var/cache/bind é‡Œé¢çš„è§£æé…ç½®æ–‡ä»¶çš„åå­—<br>    file &quot;db.kirno.com&quot;;<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>ç„¶åæŠŠ <code>/etc/bind</code> ç›®å½•ä¸‹çš„è§£æé…ç½®æ¨¡æ¿ <code>db.local</code> å¤åˆ¶åˆ° <code>/var/cache/bind</code> é‡Œé¢</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">cp /etc/<span class="hljs-built_in">bind</span>/db.local.com /var/cache/<span class="hljs-built_in">bind</span>/db.kirno.com<br></code></pre></td></tr></table></figure>
<p>ç¼–è¾‘ <code>/var/cache/bind/db.kirno.com</code> æŠŠå…¶ä¸­çš„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs undefined">@	IN	A	127.0.0.1<br></code></pre></td></tr></table></figure>
<p>æ”¹ä¸º</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs undefined">@	IN	A	192.168.2.100<br></code></pre></td></tr></table></figure>
<blockquote>
<p>å…¶ä¸­ <code>192.168.2.100</code> æ˜¯ä½ æƒ³è§£æçš„åŸŸåå¯¹åº”ç€çš„ip</p>
</blockquote>
<p>æœ€åç¼–è¾‘ <code>/etc/bind/named.conf.options</code> æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs undefined">options &#123;<br>	directory &quot;/var/cache/bind&quot;;<br><br>	// If there is a firewall between you and nameservers you want<br>	// to talk to, you may need to fix the firewall to allow multiple<br>	// ports to talk.  See http://www.kb.cert.org/vuls/id/800113<br><br>	// If your ISP provided one or more IP addresses for stable <br>	// nameservers, you probably want to use them as forwarders.  <br>	// Uncomment the following block, and insert the addresses replacing <br>	// the all-0&apos;s placeholder.<br><br>	forwarders &#123;<br>	 	223.5.5.5;<br>	&#125;;<br><br>	//========================================================================<br>	// If BIND logs error messages about the root key being expired,<br>	// you will need to update your keys.  See https://www.isc.org/bind-keys<br>	//========================================================================<br>	dnssec-validation auto;<br><br>	auth-nxdomain no;    # conform to RFC1035<br>	listen-on-v6 &#123; any; &#125;;<br>&#125;;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>å…¶ä¸­ <code>223.5.5.5</code> æ˜¯é˜¿é‡Œäº‘çš„DNSï¼Œè¿™é‡Œçš„æ„æ€å…¶å®æ˜¯å¦‚æœæœ¬åœ°æ‰¾ä¸åˆ°ç›¸åº”çš„åŸŸåï¼Œå°±ä¼šäº¤ç»™ç¬¬ä¸‰æ–¹DNSæœåŠ¡å™¨å¤„ç†,æ‰€ä»¥æ”¹æˆä»»æ„çš„å¯ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åŸŸåæœåŠ¡å™¨å³å¯ã€‚</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kirning.github.io/2018/06/28/cjxzoi3n9001jjcu9ye57ynw9/" data-id="cjxzoi3n9001jjcu9ye57ynw9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/">git</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/gitlab/">gitlab</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/07/02/cjxzoi3m6000hjcu9vm1xdi4c/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          linuxå¸¸ç”¨å‘½ä»¤
        
      </div>
    </a>
  
  
    <a href="/2018/06/19/cjxzoi3lv000ajcu9u1ib83jl/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">btæœç´¢è„šæœ¬</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dapper/">Dapper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node/">Node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/">c#</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/electron-typescript-react-antd/">electron, typescript, react, antd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gitHub/">gitHub</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gitlab/">gitlab</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript-redux/">javascript,redux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql-mysqljs-node/">mysql, mysqljs, node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redux-react-javascript-typescript/">redux,react,javascript,typescript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/åè®®/">åè®®</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/å•ç‰‡æœº/">å•ç‰‡æœº</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/æ—¥è®°/">æ—¥è®°</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ç¼–è¯‘/">ç¼–è¯‘</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Dapper/" style="font-size: 10px;">Dapper</a> <a href="/tags/Node/" style="font-size: 10px;">Node</a> <a href="/tags/c/" style="font-size: 10px;">c#</a> <a href="/tags/electron-typescript-react-antd/" style="font-size: 10px;">electron, typescript, react, antd</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/gitHub/" style="font-size: 10px;">gitHub</a> <a href="/tags/gitlab/" style="font-size: 10px;">gitlab</a> <a href="/tags/javascript/" style="font-size: 10px;">javascript</a> <a href="/tags/javascript-redux/" style="font-size: 10px;">javascript,redux</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/mysql-mysqljs-node/" style="font-size: 10px;">mysql, mysqljs, node</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/redux-react-javascript-typescript/" style="font-size: 10px;">redux,react,javascript,typescript</a> <a href="/tags/åè®®/" style="font-size: 10px;">åè®®</a> <a href="/tags/å•ç‰‡æœº/" style="font-size: 10px;">å•ç‰‡æœº</a> <a href="/tags/æ—¥è®°/" style="font-size: 20px;">æ—¥è®°</a> <a href="/tags/ç¼–è¯‘/" style="font-size: 10px;">ç¼–è¯‘</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">ä¸ƒæœˆ 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">å…­æœˆ 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">ä¸€æœˆ 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">åä¸€æœˆ 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">åæœˆ 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">ä¸ƒæœˆ 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">å…­æœˆ 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/07/12/cjxzoi3mi000qjcu99u4risrj/">mysql8withNodeJs</a>
          </li>
        
          <li>
            <a href="/2019/07/04/cjxzoi3mp000vjcu94izpsjpc/">redux</a>
          </li>
        
          <li>
            <a href="/2019/07/03/cjxzoi3o6001rjcu9yh9ndao2/">typesafe-actions-zh</a>
          </li>
        
          <li>
            <a href="/2019/06/14/cjxzoi3nb001kjcu9gjwn2gld/">æ„å»ºelectronã€typescriptã€reactã€antdåº”ç”¨</a>
          </li>
        
          <li>
            <a href="/2019/01/27/cjxzoi3mg000ojcu9qg5setqx/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 kirno<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"live2d-widget-model-wanko"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body>
</html>